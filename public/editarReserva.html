<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Editar Reserva</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container py-4">
  <h1 class="mb-4">Editar Reserva</h1>
  <form id="formReserva" enctype="multipart/form-data">
    <div class="mb-3">
      <label class="form-label">Fecha</label>
      <input type="date" name="fecha" class="form-control" required>
    </div>
    <div class="mb-3">
      <label class="form-label">Hora</label>
      <input type="time" name="hora" class="form-control" required>
    </div>
    <div class="mb-3">
      <label class="form-label">Cliente</label>
      <select name="cliente_id" class="form-select" required></select>
    </div>
    <div class="mb-3">
      <label class="form-label">Imagen (opcional)</label>
      <input type="file" name="imagen" class="form-control">
    </div>
    <button class="btn btn-primary">Guardar Cambios</button>
    <a href="index.html" class="btn btn-secondary">Cancelar</a>
  </form>

  <script>
    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');
    const form = document.getElementById('formReserva');
    const select = form.cliente_id;

    async function init() {
      // Cargar clientes
      const cRes = await fetch('/api/clientes');
      const clientes = await cRes.json();
      clientes.forEach(c => {
        select.innerHTML += `<option value="${c.id}">${c.nombre}</option>`;
      });

      // Cargar datos de la reserva
      const rRes = await fetch('/api/reservas');
      const reservas = await rRes.json();
      const reserva = reservas.find(x => x.id == id);
      if (!reserva) return alert('Reserva no encontrada');
      form.fecha.value = reserva.fecha;
      form.hora.value = reserva.hora;
      select.value = reserva.cliente_id;
    }

    form.addEventListener('submit', async e => {
      e.preventDefault();
      const data = new FormData(form);
      const res = await fetch(`/api/reservas/${id}`, {
        method: 'PUT',
        body: data
      });
      if (res.ok) window.location = 'index.html';
      else alert('Error al actualizar reserva');
    });

    init();
  </script>
</body>
</html>
